;/*FB_PKG_DELIM*/

__d("LSLocalCreateOptimisticGroupThreadStoredProcedure",["LSLocalCreateOptimisticGroupThread","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.participants;d[1]=b.nullstateDescriptionText;d[2]=b.threadName;d[3]=b.checkExistingThreads;d[4]=b.threadMetadata;return c("LSLocalCreateOptimisticGroupThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWPThreadPreview.react",["CometHeroInteractionWithDiv.react","I64","Int64Hooks","InteractionTracingMetrics","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSLocalCreateOptimisticGroupThreadStoredProcedure","LSMessagingThreadTypeUtil","LSVec","LSVerifyContactRowExistsStoredProcedure","LSVerifyThreadRowExistsStoredProcedure","MWChatInteraction","MWPActor.react","MWPThreadThemeProvider.react","MWThreadKey.react","MWXSpinner.react","Promise","ReQL","ReQLSuspense","cr:9777","gkx","promiseDone","react","recoverableViolation","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=l||(l=d("react"));e=l;var n=e.useEffect,o=e.useMemo,p={preview:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",minHeight:"x2lwn1j",$$css:!0}};function q(a){var e=(k||(k=c("useReStore")))();n(function(){c("promiseDone")(e.runInTransaction(function(e){return(h||(h=b("Promise"))).all(a.map(function(a){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(e),{authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").CLIENT_PARTIAL),blockedByViewerStatus:i.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:i.ofNumber(c("LSContactIdType").FBID),contactType:i.ofNumber(c("LSContactType").USER),contactViewerRelationship:i.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:i.ofNumber(c("LSContactGender").UNKNOWN),id:a.id,isBlocked:!1,isMemorialized:!1,isSelf:!1,workForeignEntityType:i.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}))},"readwrite",void 0,void 0,f.id+":89"))},[e,JSON.stringify(a.map(function(a){return(j||(j=d("I64"))).to_string(a.id)}))])}function r(a){var b=a.children,e=a.renderThreadPreview,f=a.renderThreadView,g=a.thread,h=d("MWChatInteraction").get("open_with_tokens");n(function(){h!=null&&(c("InteractionTracingMetrics").addAnnotation(h,"thread_id",(j||(j=d("I64"))).to_string(g.threadKey)),c("InteractionTracingMetrics").addAnnotation(h,"thread_type",j.to_string(g.threadType)),c("InteractionTracingMetrics").addAnnotationBoolean(h,"is_secure",d("LSMessagingThreadTypeUtil").isArmadilloSecure(g.threadType)))},[h,g.threadKey,g.threadType]);return e!=null?e(g,b):m.jsx(d("MWThreadKey.react").MWThreadKeyProvider,{id:g.threadKey,children:m.jsxs("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x6prxxf x2lwn1j",children:[m.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"MWV2_CHAT_TAB",interactionUUID:h,pageletName:"ChatTab",xstyle:p.preview,children:m.jsx(c("MWPThreadThemeProvider.react"),{themeFbid:g.themeFbid,children:f(g)})}),m.jsx("div",{className:"x2lah0s x879a55",children:b})]})})}r.displayName=r.name+" [from "+f.id+"]";function s(a){var b=a.children,e=a.recipientToken,g=a.renderThreadPreview,h=a.renderThreadView,j=a.setPreviewThread,l=(k||(k=c("useReStore")))(),o=e.threadType,p=e.id;q([e]);d("Int64Hooks").useEffectInt64(function(){c("promiseDone")(l.runInTransaction(function(a){return c("LSVerifyThreadRowExistsStoredProcedure")(c("LSFactory")(a),{syncGroup:(i||(i=d("LSIntEnum"))).ofNumber(1),threadKey:p,threadType:o})},"readwrite",void 0,void 0,f.id+":186"))},[l,p,o]);var s=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(l.tables.threads).getKeyRange(p)},[l,p],f.id+":197");n(function(){j(s)},[j,s]);if(s!=null)return m.jsx(r,{renderThreadPreview:g,renderThreadView:h,thread:s,children:b});else return null}s.displayName=s.name+" [from "+f.id+"]";function t(a,b){var e=(k||(k=c("useReStore")))(),g=(j||(j=d("I64"))).to_string(d("MWPActor.react").useActor()),h=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(e.tables.participants).filter(function(b){return a.has((j||(j=d("I64"))).to_string(b.contactId))}).map(function(a){return(j||(j=d("I64"))).to_string(a.threadKey)})},[e,a],f.id+":232");return d("ReQLSuspense").useFirst(function(){var c=new Set(h);return d("ReQL").fromTableAscending(e.tables.threads).filter(function(a){return(j||(j=d("I64"))).equal(a.threadType,b)}).filter(function(a){return a.threadName==null}).filter(function(a){a=a.clientThreadKey;if(a!=null)return c.has((j||(j=d("I64"))).to_string(a));else return!1}).filter(function(b){b=b.clientThreadKey;if(b==null)return!1;b=d("ReQLSuspense").toArray(d("ReQL").fromTableDescending(e.tables.participants.index("threadKeyReadWatermarkTimestampMs")).getKeyRange(b).map(function(a){return(j||(j=d("I64"))).to_string(a.contactId)}).filter(function(a){return a!==g}),f.id+":267");if(b.every(function(b){return a.has(b)}))return b.length===a.size;else return!1})},[h,e,b,g,a],f.id+":245")}function u(a,e,g,l,m,o){m===void 0&&(m=null);o===void 0&&(o=null);var p=(k||(k=c("useReStore")))();n(function(){a==null&&c("promiseDone")(p.runInTransaction(function(a){if((j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(2))){var f;return c("LSLocalCreateOptimisticGroupThreadStoredProcedure")(c("LSFactory")(a),{checkExistingThreads:l,participants:c("LSVec").ofArray(g.map(function(a){return a.id})),threadMetadata:(f=m)!=null?f:void 0,threadName:(f=o)!=null?f:void 0}).then(function(){})}else if(d("LSMessagingThreadTypeUtil").isArmadilloSecure(e))return b("cr:9777")==null?(h||(h=b("Promise"))).resolve():b("cr:9777").call(a,g,e);c("recoverableViolation")("Don't know how to create optimistic thread for thread of thread type "+(e!=null?(j||(j=d("I64"))).to_string(e):""),"messenger_web_creation");return(h||(h=b("Promise"))).resolve()},"readwrite",void 0,void 0,f.id+":312"))},[l,p,JSON.stringify(a),JSON.stringify(e),g,m])}function v(a){var b=a.checkExistingThreads,c=a.children,d=a.renderThreadPreview,e=a.renderThreadView,f=a.setPreviewThread,g=a.threadMetadata;g=g===void 0?null:g;var h=a.threadName;h=h===void 0?null:h;var i=a.threadType,j=a.tokenContactIdsMaybeExcludingActor,k=a.tokens;a=a.tokensMaybeExcludingActor;var l=t(j,i);q(a);u(l,i,k,b,g,h);n(function(){f(l)});if(l!=null)return m.jsx(r,{renderThreadPreview:d,renderThreadView:e,thread:l,children:c});else return null}v.displayName=v.name+" [from "+f.id+"]";function w(a,b,e,g,h){var l=(k||(k=c("useReStore")))(),m=(j||(j=d("I64"))).to_string(d("MWPActor.react").useActor()),n=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(l.tables.participants).filter(function(a){return b.has((j||(j=d("I64"))).to_string(a.contactId))}).map(function(a){return(j||(j=d("I64"))).to_string(a.threadKey)})},[l,b],f.id+":412"),o=c("gkx")("24167")||c("gkx")("33038");return d("ReQLSuspense").useFirst(function(){var a=new Set(n);return d("ReQL").fromTableAscending(l.tables.threads).filter(function(a){return(j||(j=d("I64"))).equal(a.threadType,e)}).filter(function(a){return o&&h!=null?a.threadName===h:a.threadName==null}).filter(function(a){if(g)return!0;else return(j||(j=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))}).filter(function(b){return a.has((j||(j=d("I64"))).to_string(b.threadKey))}).filter(function(a){a=d("ReQLSuspense").toArray(d("ReQL").fromTableDescending(l.tables.participants.index("threadKeyReadWatermarkTimestampMs")).getKeyRange(a.threadKey).map(function(a){return(j||(j=d("I64"))).to_string(a.contactId)}),f.id+":453");var c=a.filter(function(a){return a!==m});if(a.length===c.length||c.length!==b.size)return!1;else return c.every(function(a){return b.has(a)})})},[n,l,JSON.stringify(e),g,a,b,m,h,o],f.id+":428")}function x(a){var b=a.checkExistingThreads,c=a.children,e=a.renderThreadPreview,f=a.renderThreadView,g=a.setPreviewThread,h=a.threadMetadata;h=h===void 0?null:h;var i=a.threadName;i=i===void 0?null:i;var k=a.threadType,l=a.tokens,p=a.tokensMaybeExcludingActor;a=o(function(){return new Set(p.map(function(a){return(j||(j=d("I64"))).to_string(a.id)}))},[p]);var q=w(p,a,k,b,i);n(function(){q!=null&&g(q)},[g,q]);if(q!=null)return m.jsx(r,{renderThreadPreview:e,renderThreadView:f,thread:q,children:c});else return m.jsx(v,{checkExistingThreads:b,renderThreadPreview:e,renderThreadView:f,setPreviewThread:g,threadMetadata:h,threadName:i,threadType:k,tokenContactIdsMaybeExcludingActor:a,tokens:l,tokensMaybeExcludingActor:p,children:c})}x.displayName=x.name+" [from "+f.id+"]";function a(a){var b=a.areWeCreatingASecureThread,e=a.checkExistingThreads;e=e===void 0?!0:e;var f=a.children,g=a.isCutoverInProgress;g=g===void 0?!1:g;var h=a.nullstate;h=h===void 0?null:h;var k=a.renderThreadPreview,l=a.renderThreadView,p=a.setPreviewThread,q=a.threadMetadata;q=q===void 0?null:q;var r=a.threadName;r=r===void 0?null:r;var t=a.tokens,u=d("MWPActor.react").useActor();a=o(function(){return t.filter(function(a){return!(j||(j=d("I64"))).equal(a.id,u)})},[t,u]);n(function(){t.length===0&&p()},[p,t]);if(g)return m.jsx("div",{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k",children:m.jsx(c("MWXSpinner.react"),{color:"disabled",size:24})});if(t.length===0)return h;g=a.length;if(g!==1){if(g===0)return b?h:m.jsx(s,{recipientToken:t[0],renderThreadPreview:k,renderThreadView:l,setPreviewThread:p,children:f})}else{g=a[0];if(e)if(b)return m.jsx(x,{checkExistingThreads:e,renderThreadPreview:k,renderThreadView:l,setPreviewThread:p,threadMetadata:q,threadType:(i||(i=d("LSIntEnum"))).ofNumber(15),tokens:t,tokensMaybeExcludingActor:a,children:f});else return m.jsx(s,{recipientToken:g,renderThreadPreview:k,renderThreadView:l,setPreviewThread:p,children:f})}return m.jsx(x,{checkExistingThreads:e,renderThreadPreview:k,renderThreadView:l,setPreviewThread:p,threadMetadata:q,threadName:r,threadType:b?(i||(i=d("LSIntEnum"))).ofNumber(16):(i||(i=d("LSIntEnum"))).ofNumber(2),tokens:t,tokensMaybeExcludingActor:a,children:f})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWDefaultE2eeThreadPreview.react",["CometPlaceholder.react","CometProgressRingIndeterminate.react","I64","LSIntEnum","LSSearchType","LSThreadAttributionStore","MWComposerGating.react","MWOpenAndSecureThreadView.react","MWPThreadPreview.react","MWPThreadThemeProvider.react","MWRelayChatTabHeaderRoot.react","MWV2ChatTabHeader.react","MWV2TabContainer","ReQL","ReQLSuspense","qex","react","useMWChatStateUpdateThreadKeyDescriptorIfAuthoritative","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||(k=d("react"));b=k;var m=b.useEffect,n=b.useState,o=(e=c("qex")._("724"))!=null?e:!1;function a(a){var b,e,g=a.otherContactIdForDefaultE2eeThread;a=a.tab;var k=(h||(h=c("useReStore")))(),p=d("ReQLSuspense").useFirst(function(){return g==null?d("ReQL").empty():d("ReQL").fromTableAscending(k.tables.contacts,["blockedByViewerStatus","name","profilePictureUrl","id"]).getKeyRange(g)},[k,g],f.id+":58"),q=n(),r=q[0];q=q[1];c("useMWChatStateUpdateThreadKeyDescriptorIfAuthoritative")(r,a,{shouldClearOldHiddenTab:!1,shouldUpdateThreadType:!1});var s=r==null?void 0:r.threadKey;m(function(){if(s==null||g==null)return;var a=d("LSThreadAttributionStore").getSource(void 0,(i||(i=d("I64"))).to_string(g));a.value!=="unknown"&&(a.type==="LSThreadAttribution"?d("LSThreadAttributionStore").setLSMessagingThreadAttribution((i||(i=d("I64"))).to_string(s),i.to_string(a.value)):d("LSThreadAttributionStore").setSource((i||(i=d("I64"))).to_string(s),a.value))},[s,g]);var t=l.jsx("div",{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k",children:l.jsx(c("CometProgressRingIndeterminate.react"),{color:"disabled",size:24})});b=r!=null&&l.jsx(c("CometPlaceholder.react"),{fallback:null,children:l.jsx(c("MWPThreadThemeProvider.react"),{themeFbid:r.themeFbid,children:l.jsx(d("MWComposerGating.react").MWChatComposerGating,{isPreviewThread:!0,thread:r},(i||(i=d("I64"))).to_string((b=r.clientThreadKey)!=null?b:r.threadKey))})});p=p!=null?[{blockedByViewerStatus:p.blockedByViewerStatus,contextLine:"",displayName:p.name,id:p.id,profilePicUrl:p.profilePictureUrl,threadType:(j||(j=d("LSIntEnum"))).ofNumber(15),type_:(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchType").CONTACT)}]:[];return l.jsxs(c("MWV2TabContainer"),{tab:a,threadKey:(e=r==null?void 0:r.threadKey)!=null?e:void 0,children:[r&&l.jsx(l.Fragment,{children:o?l.jsx(c("MWRelayChatTabHeaderRoot.react"),{tab:a,threadKey:r.threadKey}):l.jsx(c("MWV2ChatTabHeader.react"),{tab:a,thread:r})}),l.jsx(c("CometPlaceholder.react"),{fallback:null,children:l.jsx(c("MWPThreadPreview.react"),{areWeCreatingASecureThread:!0,nullstate:t,renderThreadView:function(a){return l.jsx(c("MWOpenAndSecureThreadView.react"),{thread:a})},setPreviewThread:q,tokens:p,children:b})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);