;/*FB_PKG_DELIM*/

__d("CryptoLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("FBLogger")("labyrinth_web","crypto."+a)}function b(a,b){return b instanceof Error?a.catching(b):a}g.CryptoLogger=a;g.captureError=b}),98);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(a,b,c,d,e,f){"use strict";a=16;b=28;c=16;d=128;f.hChaCha20SubKeyNonceLengthInBytes=a;f.totalNonceLengthInBytes=b;f.aesGcmTagLengthInBytes=c;f.aesGcmTagLength=d}),66);
__d("HChaCha20",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}a.fromHexString=function(a){var b=a.match(/[A-Fa-f0-9]{1,2}/g);if(a.length===0||a.length%2!==0||b==null)throw c("err")('The string "'+a+'" is not valid hex.');return new Uint8Array(b.map(function(a){return parseInt(a,16)}))};a.bufferToUint32Array=function(a){var b=new DataView(a),c=[];a=a.byteLength/4;for(var d=0;d<a;d++)c.push(new DataView(b.buffer.slice(d*4,d*4+4)).getInt32(0));return Uint32Array.from(c)};a.rotate=function(a,b){a=a&4294967295;b=b&31;return(a<<b|a>>>32-b)>>>0};a.quarterRound=function(b,c,d,e){b=b;c=c;d=d;e=e;b=b+c&4294967295;e=a.rotate(e^b,16);d=d+e&4294967295;c=a.rotate(c^d,12);b=b+c&4294967295;e=a.rotate(e^b,8);d=d+e&4294967295;c=a.rotate(c^d,7);return[b>>>0,c>>>0,d>>>0,e>>>0]};var b=a.prototype;b.createHCtx=function(b,d){var e=new Uint32Array(16),f=a.fromHexString("657870616e642033322d62797465206b");if(f.byteLength!==16)throw c("err")("Could not create context. Invalid constant buffer length of "+f.byteLength+". Expected a length of 16");else if(b.byteLength!==32)throw c("err")("Could not create context. Invalid key buffer length of "+b.byteLength+". Expected a length of 32");else if(d.byteLength!==16)throw c("err")("Could not create context. Invalid nonce buffer length of "+d.byteLength+". Expected a length of 16");f=a.bufferToUint32Array(f.buffer);b=a.bufferToUint32Array(b);d=a.bufferToUint32Array(d);e.set(f);e.set(b,f.length);e.set(d,f.length+b.length);return e.buffer};b.hChaCha20Bytes=function(b,c){c=new DataView(this.createHCtx(c,b));b=c.getInt32(0);var d=c.getInt32(1<<2),e=c.getInt32(2<<2),f=c.getInt32(3<<2),g=c.getInt32(4<<2),h=c.getInt32(5<<2),i=c.getInt32(6<<2),j=c.getInt32(7<<2),k=c.getInt32(8<<2),l=c.getInt32(9<<2),m=c.getInt32(10<<2),n=c.getInt32(11<<2),o=c.getInt32(12<<2),p=c.getInt32(13<<2),q=c.getInt32(14<<2);c=c.getInt32(15<<2);for(var r=0;r<10;r++){var s=a.quarterRound(b,g,k,o);b=s[0];g=s[1];k=s[2];o=s[3];s=a.quarterRound(d,h,l,p);d=s[0];h=s[1];l=s[2];p=s[3];s=a.quarterRound(e,i,m,q);e=s[0];i=s[1];m=s[2];q=s[3];s=a.quarterRound(f,j,n,c);f=s[0];j=s[1];n=s[2];c=s[3];s=a.quarterRound(b,h,m,c);b=s[0];h=s[1];m=s[2];c=s[3];s=a.quarterRound(d,i,n,o);d=s[0];i=s[1];n=s[2];o=s[3];s=a.quarterRound(e,j,k,p);e=s[0];j=s[1];k=s[2];p=s[3];s=a.quarterRound(f,g,l,q);f=s[0];g=s[1];l=s[2];q=s[3]}return Uint32Array.from([b,d,e,f,o,p,q,c]).buffer};return a}();g.HChaCha20=a}),98);
__d("LSMaxInt32",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_int32(2147483647);g["default"]=a}),98);
__d("RetUtil",["LSResult"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSResult")(a)}g.getNullableRetResult=a}),98);
__d("LSCreateDerivedKeys.nop",["CryptoLogger","I64","LSMaxInt32","LSVec","Promise","RetUtil","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j,k){var l=d("CryptoLogger").CryptoLogger("create_derived_keys");a=c("LSVec").toArray(k);if(a.length<1||a.some(function(a){return(i||(i=d("I64"))).gt(a,c("LSMaxInt32"))})){l.mustfix("Invalid key lengths for derive keys");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))}var m=a.map((i||(i=d("I64"))).to_int32),n=a.map(i.to_int32).reduce(function(a,b){return a+b},0)*8;return d("XPlatReactCrypto").subtleImportKey("raw",j,"HKDF",!1,["deriveBits"]).then(function(a){var b;return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:f,name:"HKDF",salt:(b=g)!=null?b:new Uint8Array(10).buffer},a,n)}).then(function(a){a=new Uint8Array(a);var b=[],e=0;for(var f=0,g=m.length;f<g;++f){var h=e+m[f];b.push(a.slice(e,h).buffer);e=h}return d("RetUtil").getNullableRetResult(c("LSVec").ofArray(b))})["catch"](function(a){l.catching(a).mustfix("Failed to create derived keys");return d("RetUtil").getNullableRetResult()})};g["default"]=a}),98);
__d("LSDeleteBackupOnClient",["LSAppendDataTraceAddon","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] Beginning execution."),d[1]="Beginning deleteBackupOnClient stored procedure",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[1]].join("")),d[2]=c.createArray(),void 0!==void 0?d[11]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[1]].join(""),d[2],c.i64.cast([0,4]))},function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1423]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[3]=a[0],a})},function(a){return d[3]?d[4]=!0:d[4]=!1,d[4]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(168).fetch(),function(a){return a["delete"]()})},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(169).fetch([[[a[0]]],"fk_secure_encrypted_backups_client_state"]),function(a){return a["delete"]()}):c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.db.table(190).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.db.table(174).fetch(),function(a){return a["delete"]()})},function(b){return a[1]==="fetch_virtual_device"?c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,4])}):c.resolve()},function(e){return a[2]?c.sequence([function(a){return d[11]="Clearing backups tables",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[11]].join("")),d[12]=c.createArray(),void 0!==void 0?d[19]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[11]].join(""),d[12],c.i64.cast([0,4]))},function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1891]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(a){return c.forEach(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){var b=a.update;a.item;return b({backupId:void 0})})},function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1892]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.filter(c.db.table(184).fetch(),function(b){return c.i64.eq(b.backupId,a[0])}),function(a){return a["delete"]()}):c.forEach(c.db.table(184).fetch(),function(a){return a["delete"]()})},function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,1893]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(196).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(196).fetch(),function(a){return a["delete"]()})}]):c.resolve()},function(e){return a[5]?c.sequence([function(e){return a[5]?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,84]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]):a[3]!==void 0?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),"The flow did not succeed",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}]):a[4]!==void 0?c.sequence([function(e){return d[14]=["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",a[4]].join(""),function(a){c.logger(a).mustfix(a)}(d[14]),d[11]=c.createArray(),a[3]!==void 0?d[15]=(d[11].push(a[3]),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",a[4],d[11],c.i64.cast([0,3]))},function(e){return a[3]!==void 0?c.sequence([function(e){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),d[14],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(e){return a[3]!==void 0?c.sequence([function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetBlobFromString.nop",["CryptoLogger","LSResult","Promise","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){a=new(d("XPlatReactTextEncoder").TextEncoder)();try{e=a.encode(f).buffer;return(h||(h=b("Promise"))).resolve(c("LSResult")(e))}catch(g){e=d("CryptoLogger").CryptoLogger("get_blob_from_string");e.catching(g).mustfix(g.message?g.message:"Error in get blob from string.");e=a.encode(f).buffer;return(h||(h=b("Promise"))).resolve(c("LSResult")(e))}};g["default"]=a}),98);
__d("LSHmac_v2.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g){return d("XPlatReactCrypto").subtleImportKey("raw",f,{hash:"SHA-256",name:"HMAC"},!1,["sign"]).then(function(a){return d("XPlatReactCrypto").subtleSign("HMAC",a,g)}).then(function(a){return(h||(h=b("Promise"))).resolve(c("LSResult")(a))})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("hmac_v2"),a).mustfix("Crypto signing failed");throw a})};g["default"]=a}),98);
__d("LSIssuePointQueryRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Beginning execution."),a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,2512]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[1]?d[2]=!0:d[2]=!1,d[2]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()},function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Point query restore v2 is enabled"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,1])),d[13].set("error_message",""),d[13].set("stored_procedure","issuePointQueryRestoreTask"),d[14]=new c.Map(),d[14].set("act_thread_id",a[0]),d[15]=new c.Map(),d[15].set("restore_context",d[14]),d[15].set("failure",d[13]),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[24]=c.i64.of_float(Date.now()),d[16]=c.i64.add(d[24],c.i64.cast([0,0]))):d[16]=c.i64.cast([0,0]),d[17]=d[15].get("restore_context"),d[15],d[18]=d[15].get("success"),d[15],d[18]!==void 0?(d[24]=d[18].get("message_id"),d[18],d[19]=d[24]):d[19]="",d[20]=d[17].get("act_thread_id"),d[17],d[21]=":",d[22]=c.toJSON(d[15]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",d[21],d[20],d[21],d[19]].join(""),c.i64.cast([0,50035]),d[22],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[16],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[3]=d[23]}]):(f=e.item,c.sequence([function(a){return d[19]=f.deviceId,d[18]=f.backupTenancy,d[17]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[13]=void 0):c.sequence([function(a){return d[20]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[30]=(d[20].push(c.i64.cast([0,0])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[30]=(d[20].push(c.i64.cast([0,2])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[30]=(d[20].push(c.i64.cast([0,3])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[30]=(d[20].push(c.i64.cast([0,4])),d[20]):0,d[25]=c.createArray(),d[26]=c.i64.of_int32(d[20].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[25].push(d[31]),d[25])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[33]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[33]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[36]=(d[30].push(c.i64.to_string(d[34])),d[30])}])}):c.resolve()},function(a){return d[32]=d[30].join(","),d[27]=d[32]}])},function(a){return d[25].some(function(a){return c.i64.eq(d[17],a)})?d[28]=d[17]:d[28]=void 0,c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=void 0,d[13]=d[29]}])},function(e){return c.i64.neq(d[13],void 0)?d[14]=d[13]:d[14]=c.i64.cast([0,0]),c.i64.neq(d[18],void 0)?d[15]=d[18]:d[15]=c.i64.cast([0,1]),c.i64.neq(d[19],void 0)?c.sequence([function(e){return d[20]=new c.Map(),d[20].set("act_thread_id",a[0]),d[20].set("request_id",a[3]),d[20].set("tam_thread_subtype",c.i64.cast([0,0])),d[20].set("source",a[4]),c.nativeOperation(b("LSBase64Encode.nop"),f.ocmfClientStateBlob).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.mailboxRootKeyBlob).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=new c.Map(),d[23].set("ocmf_client_state_blob",d[21]==null?"":d[21]),d[23].set("mailbox_root_key",d[22]==null?"":d[22]),d[24]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[40]=(d[24].push(a.epochId),d[24])})},function(a){return d[38]="Queried locally available epochs. Count: ",d[25]=c.i64.of_int32(d[24].length),d[39]=c.i64.to_string(d[25]),d[26]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[26],d[38],d[26],d[39]].join("")),c.resolve()},function(e){return d[27]=new c.Map(),d[27].set("device_id",d[19]),d[27].set("raw_tokens",d[23]),d[27].set("locally_available_epochs",d[24]),d[28]=new c.Map(),d[28].set("reference_timestamp",a[2]),d[28].set("device_context",d[27]),d[28].set("message_id",a[1]),d[29]=new c.Map(),d[29].set("restore_context",d[20]),d[29].set("success",d[28]),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[40]=c.i64.of_float(Date.now()),d[30]=c.i64.add(d[40],c.i64.cast([0,0]))):d[30]=c.i64.cast([0,0]),d[31]=d[29].get("restore_context"),d[29],d[32]=d[29].get("success"),d[29],d[32]!==void 0?(d[40]=d[32].get("message_id"),d[32],d[33]=d[40]):d[33]="",d[34]=d[31].get("act_thread_id"),d[31],d[35]=":",d[36]=c.toJSON(d[29]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",d[35],d[34],d[35],d[33]].join(""),c.i64.cast([0,50035]),d[36],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[30],c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[16]=d[37]}]):c.sequence([function(e){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,1])),d[20].set("error_message",""),d[20].set("stored_procedure","issuePointQueryRestoreTask"),d[21]=new c.Map(),d[21].set("act_thread_id",a[0]),d[22]=new c.Map(),d[22].set("restore_context",d[21]),d[22].set("failure",d[20]),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[31]=c.i64.of_float(Date.now()),d[23]=c.i64.add(d[31],c.i64.cast([0,0]))):d[23]=c.i64.cast([0,0]),d[24]=d[22].get("restore_context"),d[22],d[25]=d[22].get("success"),d[22],d[25]!==void 0?(d[31]=d[25].get("message_id"),d[25],d[26]=d[31]):d[26]="",d[27]=d[24].get("act_thread_id"),d[24],d[28]=":",d[29]=c.toJSON(d[22]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",d[28],d[27],d[28],d[26]].join(""),c.i64.cast([0,50035]),d[29],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[23],c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[16]=d[30]}])},function(a){return d[3]=d[16]}]))})},function(d){return a[3]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[3],c.i64.cast([0,2513]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[5]=a[0],a})},function(a){return d[5]?d[6]=!0:d[6]=!1,d[6]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[3]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSPlatformArmadilloUtils",["MAWMICSafe","Promise","cr:6998","cr:7349","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h=b("cr:6998"))!=null?h:b("cr:7349"),k=[];function a(a){k.push(a)}function e(){j==null?void 0:j.completeSync();if(k.length===0){j==null?void 0:j.maybeEndOccamadilloThreadMapping();return}c("promiseDone")((i||(i=b("Promise"))).allSettled(k.map(function(a){return a()})),function(){return j==null?void 0:j.maybeEndOccamadilloThreadMapping()})}function f(){d("MAWMICSafe").markEvent("ls_init_end")}function l(a){d("MAWMICSafe").fail("init_sync_failure",a)}g.executeOnThreadMappingEnd=a;g.occamadilloInitEnd=e;g.reportInitEnd=f;g.reportInitSyncFailure=l}),98);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a<10)return 10-a;var b=Math.floor(Math.log2(a)),c=Math.floor(Math.log2(b))+1;b=b-c;c=(1<<b)-1;b=a+c&(c^-1);return b-a}function i(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=a.byteLength,d=h(c);d=b+c+d;d=new DataView(new ArrayBuffer(d));d.setUint32(0,c);c=new Uint8Array(d.buffer);c.set(new Uint8Array(a),b);return c.buffer}function a(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();b=b.encode(a).buffer;return i(b)}function b(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(a);if(c.byteLength<b)return;var d=a.byteLength;c=c.getUint32(0);d=d-b;if(c>=0&&c<=d)return a.slice(b,b+c)}g.getPaddingLength=h;g.padData=i;g.pad=a;g.stripPadding=b}),98);
__d("LSSymmetricEncryptionCreateDecryptedData.nop",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_data");a=function(a,c,e,f,g){if(g.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes){i.mustfix("cipher text is invalid");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}a=new Uint8Array(g);var j=a.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);c=new(d("HChaCha20").HChaCha20)();var k=a.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;g=c.hChaCha20Bytes(j.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,e);return d("XPlatReactCrypto").subtleImportKey("raw",g,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(j.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,k)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);a==null&&i.mustfix("Failed to strip padding for symmetric decryption");return d("RetUtil").getNullableRetResult(a)})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data decryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.nop","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return c("LSResult")(a)}a=function(a,b,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string");g=d("Base64Utils").toArrayBuffer(g);return c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g).then(function(a){a=a[0];return a}).then(function(a){return a==null?h():h(new(d("XPlatReactTextDecoder").TextDecoder)().decode(a))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric string decryption failed");return h()})};g["default"]=a}),98);