;/*FB_PKG_DELIM*/

__d("LSMessageContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({TEXT:1,MEDIA_PREVIEW:2,AUDIO_CLIP:4,XMA_FALLBACK:8,LWA_WAVE:16,ADMIN:32,FILE_ATTACHMENT:64,GLYPH:128,TOMBSTONE:256,STORY_REPLY:512,SINGLE_XMA:1024,HSCROLL_XMA:2048,STICKER:4096,FORWARD_INDICATOR:8192,ANIMATED_IMAGE:16384,NULL_STATE:32768,ENCRYPTION_PLACEHOLDER:65536,FUTUREPROOF_PLACEHOLDER:131072,UNAVAILABLE_PLACEHOLDER:262144,LOCATION_PLACEHOLDER:524288,POLL_CREATION_PLACEHOLDER:1048576,CONTACT_SHARE_PLACEHOLDER:2097152,STORY_MENTION_PLACEHOLDER:4194304,META_AI_MESSAGE_PLACEHOLDER:8388608,BUMP_MESSAGE_PLACEHOLDER:16777216,BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_PLACEHOLDER:33554432});f["default"]=a}),66);
__d("MWEncryptedBackupsIssueRangeQueryDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWEncryptedBackupsIssueRangeQuery").__setRef("MWEncryptedBackupsIssueRangeQueryDeferred");function a(a){var b=a.chatJid,c=a.db,d=a.newerNumMessages,e=a.numMessages,f=a.sortOrderMs,g=a.threadId;h.onReady(function(a){a.runQuery(b,c,g,f,e,d)})}g.issueRangeQueryDeferred=a}),98);
__d("MAWFetchCutoverMessages",["I64","LSFactory","LSIssueMessagesRangeQueryStoredProcedure","MAWBridgeSendAndReceive","MAWDbMsg","MAWMiActOnActThreadReady","MWEncryptedBackupsIssueRangeQueryDeferred","Promise","ReQL","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["useFetchSecureMessages: threadJid: "," threadId: "," minMsgSortOrderTsResponse ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWFetchCutoverMessages: response is ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["'MAWFetchCutoverMessages: start loadMoreMsgs'"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["labyrinth_web","useFetchSecureMessages"]);function n(a,d,e,g){return a.runInTransaction(function(a){return g!=null&&e!=null?c("LSIssueMessagesRangeQueryStoredProcedure")(c("LSFactory")(a),{direction:d,referenceTimestampMs:e.minTimestampMs,threadKey:g}):(i||(i=b("Promise"))).resolve()},"readwrite",void 0,void 0,f.id+":35")}function a(a,b,c,d,e){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.messages_ranges_v2__generated).getKeyRange(c))),i=(yield d("ReQL").firstAsync(e!=null?d("ReQL").fromTableAscending(a.tables.messages_ranges_v2__generated).getKeyRange(e):d("ReQL").empty()));if(g==null)return;var o=g.hasMoreBefore,p=d("MAWDbMsg").toMsgId(g.minMessageId);return d("MAWMiActOnActThreadReady").onActThreadReady(a.tables,c,"MAWFetchMoreMessages",function(c,g,q){m.LOG(l());return d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMoreMsgs",{chatJid:q,direction:"before",numMsgs:f,offsetMsgId:p,threadId:g}).then(function(c){m.LOG(k(),c.hasMoreBefore.toString());if(c.hasMoreBefore)return;return d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMaybeNextNonAdminMsgSortOrderMs",{chatJid:q,mayBeAdminMsgId:p}).then(function(c){m.LOG(j(),q,g,c.minMsgTimestampMs);d("MWEncryptedBackupsIssueRangeQueryDeferred").issueRangeQueryDeferred({chatJid:q,db:a,newerNumMessages:(h||(h=d("I64"))).zero,numMessages:h.of_string("10"),sortOrderMs:h.of_float(c.minMsgTimestampMs),threadId:g});if(!o)return n(a,b,i,e)})})})});return o.apply(this,arguments)}g["default"]=a}),98);
__d("MAWFetchSecureMessages",["I64","MAWBridgeSendAndReceive","MAWDbMsg","MAWMiActOnActThreadReady","MWEncryptedBackupsIssueRangeQueryDeferred","ReQL","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWFetchSecureMessages: threadJid: "," threadId: "," minMsgSortOrderTsResponse ",""]);i=function(){return a};return a}var j=10;function a(a,b,c,d,e,f,g){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,k){g===void 0&&(g=j);var l=k.addQPLAnnotations,m=k.markQPLFailure,n=k.markQPLPoint,o=k.markQPLStart;k=k.markQPLSuccess;var p=o();function q(a){n(p,"load_more_msgs_success","successfully loaded messages from worker"),l(p,a)}n(p,"before_start_load_more_msgs","before fetching messages range from table");l(p,{string:babelHelpers["extends"]({direction:f,thread_id:(h||(h=d("I64"))).to_string(c)},e!=null?{thread_type:(h||(h=d("I64"))).to_string(e)}:{})});o=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.messages_ranges_v2__generated).getKeyRange(c)));try{if(o!=null&&!o.isLoadingBefore&&f==="before"){n(p,"start_load_more_msgs","starting the load more QPL event");e=(yield d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,c,"MAWFetchMoreMessages"));c=e.chatId;e=e.chatJid;n(p,"put_message_range","put txn in messages_ranges_v2__generated table");yield b.messages_ranges_v2__generated.put({hasMoreAfter:o.hasMoreAfter,hasMoreBefore:o.hasMoreBefore,isLoadingAfter:o.isLoadingAfter,isLoadingBefore:!0,maxMessageId:o.maxMessageId,maxTimestampMs:o.maxTimestampMs,minMessageId:o.minMessageId,minTimestampMs:o.minTimestampMs,threadKey:o.threadKey});n(p,"send_loadMoreMsgs_to_backend","calling backend with loadMoreMsgs");b=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMoreMsgs",{chatJid:e,direction:f,numMsgs:g,offsetMsgId:d("MAWDbMsg").toMsgId(o.minMessageId),threadId:c}));q({bool:{hasMoreBefore:b.hasMoreBefore}});if(b.hasMoreBefore){k(p);return}f=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMaybeNextNonAdminMsgSortOrderMs",{chatJid:e,mayBeAdminMsgId:d("MAWDbMsg").toMsgId(o.minMessageId)}));d("WATagsLogger").TAGS(["labyrinth_web","MAWFetchSecureMessages"]).LOG(i(),e,c,f.minMsgTimestampMs);n(p,"issued_range_query","MAWFetchSecureMessages: minMsgSortOrderTsResponse "+f.minMsgTimestampMs);k(p);return d("MWEncryptedBackupsIssueRangeQueryDeferred").issueRangeQueryDeferred({chatJid:e,db:a,newerNumMessages:(h||(h=d("I64"))).zero,numMessages:h.of_int32(g),sortOrderMs:h.of_float(f.minMsgTimestampMs),threadId:c})}l(p,{bool:{isLoadingAfter:o==null?void 0:o.isLoadingAfter,isLoadingBefore:o==null?void 0:o.isLoadingBefore}});n(p,"already_loading_messages","end the load more QPL event.");k(p)}catch(a){m(p,a)}});return k.apply(this,arguments)}g["default"]=a}),98);
__d("useMAWQPLLogger",["MAWQPLLogger","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useMemo;function a(a){return i(function(){return c("MAWQPLLogger")(a)},[a])}g.useMAWQPLLogger=a}),98);
__d("MAWFetchMoreMessages",["Int64Hooks","MAWFetchCutoverMessages","MAWFetchSecureMessages","MAWSecureLocalDBDataSource","promiseDone","qpl","useMAWQPLLogger","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=(h||(h=c("useReStore")))();return d("Int64Hooks").useCallbackInt64(function(d){c("promiseDone")(c("MAWFetchCutoverMessages")(f,d,a,b,e))},[f,a,b,e])}function b(){return d("Int64Hooks").useMemoInt64(function(){return new(c("MAWSecureLocalDBDataSource"))()},[])}function e(a){var b=(h||(h=c("useReStore")))(),e=d("useMAWQPLLogger").useMAWQPLLogger(c("qpl")._(25303796,"1974"));return d("Int64Hooks").useCallbackInt64(function(d,f,g,h){return c("MAWFetchSecureMessages")(b,d,f,a,g,h,e)},[b,e,a])}g.useFetchCutoverMessages=a;g.useSecureDataStorage=b;g.useFetchSecureMessages=e}),98);
__d("MWMediaRenderQplUtils",["I64","LSIntEnum","LSMessageContentType","LSXmaContentType","MessagingAttachmentType","MessagingThreadType","QPLUserFlow","Random","objectEntries","qpl","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=h||d("react"),l=k.useEffect,m=k.useMemo,n=k.useRef,o=c("qpl")._(25302828,"2195"),p=1e3*60,q=c("objectEntries")(c("LSMessageContentType")).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function a(a){return r(a.displayedContentTypes)}function r(a){return(a=q.get((i||(i=d("I64"))).to_float(a)))!=null?a:"UNKNOWN"}function s(a){var b;if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE)))b=(j||(j=d("LSIntEnum"))).ofNumber(16384);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)))b=(j||(j=d("LSIntEnum"))).ofNumber(2);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)))b=(j||(j=d("LSIntEnum"))).ofNumber(2);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)))b=(j||(j=d("LSIntEnum"))).ofNumber(4);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)))b=(j||(j=d("LSIntEnum"))).ofNumber(64);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)))b=(j||(j=d("LSIntEnum"))).ofNumber(64);else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA)))b=(j||(j=d("LSIntEnum"))).ofNumber(1024);else return"UNKNOWN";return r(b)}var t=c("objectEntries")(c("MessagingAttachmentType")).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function b(a){return u(a.attachmentType)}function u(a){return(a=t.get((i||(i=d("I64"))).to_float(a)))!=null?a:"UNKNOWN"}var v=c("objectEntries")(c("MessagingThreadType")).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function e(a){a=a.threadType;return w(a)}function w(a){return(a=v.get((i||(i=d("I64"))).to_float(a)))!=null?a:"UNKNOWN"}var x=c("objectEntries")(c("LSXmaContentType")).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function y(a){return(a=x.get((i||(i=d("I64"))).to_float(a)))!=null?a:"UNKNOWN"}function z(a,b,d){return{addAnnotations:function(d){c("QPLUserFlow").addAnnotations(a,d,{instanceKey:b})},addPoint:function(d,e){e&&c("QPLUserFlow").addAnnotations(a,e,{instanceKey:b}),c("QPLUserFlow").addPoint(a,d,{instanceKey:b})},endFail:function(e,f){c("QPLUserFlow").endFailure(a,e,{annotations:f,instanceKey:b}),d.current=b},endSuccess:function(e){c("QPLUserFlow").endSuccess(a,{annotations:e,instanceKey:b}),d.current=b},getInstanceKey:function(){return b},markError:function(d,e,f){return c("QPLUserFlow").markError(a,d,{debugInfo:e,error:f,instanceKey:b})}}}function f(a,b,d){var e=n(),f=n(),g=a.attachmentType;l(function(){return function(){e.current!=null&&f.current!==e.current&&c("QPLUserFlow").endCancel(o,{instanceKey:e.current})}},[]);var h=m(function(){var h=A();e.current=h;c("QPLUserFlow").start(o,{annotations:{string:{attachment_type:u(g),content_type:s(g),entry_point:d,thread_type:w(b),transport_key:a.transportKey}},cancelOnUnload:!0,instanceKey:h,timeoutInMs:p});a.xmaContentType!=null&&c("QPLUserFlow").addAnnotations(o,{string:{xma_content_type:y(a.xmaContentType)}},{instanceKey:h});return babelHelpers["extends"]({},z(o,h,f))},[a.messageId]);return h}function A(){return Date.now()+Math.round(d("Random").random()*1e4)}g.event=o;g.QPL_TIMEOUT=p;g.getMessageContentTypeString=a;g.getMessageContentTypeStringFromEnum=r;g.deriveMessageContentTypeStringFromAttachmentTypeLessAccurate=s;g.getAttachmentTypeString=b;g.getAttachmentTypeStringFromEnum=u;g.getThreadTypeString=e;g.getThreadTypeStringFromEnum=w;g.getXmaContentTypeStringFromEnum=y;g.createQplFlowCommon=z;g.useCommonMediaRenderQplForAttachment=f}),98);
__d("useRegisterMAWThreadEvent",["I64","Int64Hooks","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","MAWMiActOnActThreadReady","MAWThreadEvent","Promise","promiseDone","useMWGetOtherUserContact","useMWIsReadReceiptsDisabledForThread","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a){var e=a.authorityLevel,f=a.threadKey,g=a.threadType,l=(j||(j=d("I64"))).ge(e,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)),m=(i||(i=c("useReStore")))(),n=c("useMWIsReadReceiptsDisabledForThread")(a.threadKey),o=c("useMWGetOtherUserContact")(a.threadKey,a.threadType,["capabilities","capabilities2","contactViewerRelationship","blockedByViewerStatus"]);d("Int64Hooks").useEffectInt64(function(){d("LSMessagingThreadTypeUtil").isArmadilloSecure(g)&&l&&c("promiseDone")(d("MAWMiActOnActThreadReady").onActThreadReady(m.tables,f,"useRegisterMAWThreadEvent",function(a,c,e){d("MAWThreadEvent").setThreadEventHandler(e,o,n);return(h||(h=b("Promise"))).resolve()}))},[f,g,l,m,n,o])}g["default"]=a}),98);